{% extends "base.html" %}
{% load i18n %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap-responsive.min.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/controller.css">
<script src="{{ STATIC_URL }}js/functions.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/bootstrap.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {

    $.m_set_mobile_interaction_url = '{{ spectacle.set_mobile_interaction_url }}';
    $.m_get_mobile_interaction_url = '{{ spectacle.get_mobile_interaction_url }}';
    $.m_get_chosen_commands_url = '{{ spectacle.get_chosen_commands_url }}';
    $.m_get_commands_url = '{{ spectacle.get_commands_url }}';
    $.m_decrease_happiness_url = '{{ spectacle.decrease_happiness_url }}';
    $.m_get_happiness_meter_url = '{{ spectacle.get_happiness_meter_url }}';
    $.m_set_hard_chosen_commands_url = '{{ spectacle.set_hard_chosen_commands_url }}';
    $.m_reset_spectacle_url = '{{ spectacle.reset_spectacle_url }}';
    $.m_change_spectacle_mode_url = '{{ spectacle.change_spectacle_mode_url }}';
    $.m_get_controller_url = '{{ spectacle.get_controller_url }}';


    $('.mobile-interaction').click(function() {
        set_mobile_interaction();
        return false;
    });

    get_commands();
    get_chosen_commands();

    $('#decrease-happiness').click(function() {
        decrease_happiness();
        return false;
    });

    $('#reset-spectacle').click(function() {
        if (confirm("Do you really want to delete all spectacle data?")) {
            reset_spectacle();
        }
        return false;
    });

    $('#change-spectacle-mode').click(function() {
        if (confirm("Do you really want to change spectacle mode from EASY to HARD?")) {
            change_spectacle_mode();
        }
        return false;
    });

});

var s10 = 10000; // 10s
var happiness_meter_refresh = setInterval(function(){ get_happiness_meter(); }, s10);
var commands_refresh = setInterval(function (){ get_commands();}, s10);
var chosen_commands_refresh = setInterval(function (){ get_chosen_commands(); }, s10);

</script>

{% if spectacle.mode == '2' %}
<script src="{{ STATIC_URL }}js/jquery-countdown/jquery.countdown.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {

    $("#hard_duration").change(function () {
        var d = $('#hard_duration option:selected').val().split(':')
        if ( d != '' ) {
            // FIXME
            var duration = parseInt(d[0])*60*60 + parseInt(d[1])*60 + parseInt(d[2]);
            $('#hard-countdown').countdown('destroy');
            $('#hard-countdown').countdown({
                until: duration,
                onExpiry: hard_chosen_command,
                format: 'MS',
                compact: true,
            });
            $('#hard_duration').val('').attr('selected', true);

            $.m_set_last_scene_duration_url = '{{ spectacle.set_last_scene_duration_url }}';

            set_mobile_interaction(duration);
        }
    });

    function hard_chosen_command() {
        set_hard_chosen_commands();
    }

});
</script>
{% endif %}


{% endblock %}


{% block content %}
<div class="container">
  <div class="page-header">
    <h1>Painel de controle</h1>
  </div>
  <div class="row">
    <div class="span3">
      <div id="mode">
        <h2>Modo</h2>
        {% if spectacle.mode == '1' %}
        <button class="btn">HARD</button> <button class="btn btn-info">EASY</button>
        {% elif spectacle.mode == '2' %}
        <button class="btn btn-info">HARD</button>  <button class="btn">EASY</button>
        {% endif %}
      </div>
    </div>
    <div class="span3">
      <h2>Interação</h2>
      <div id="mobile_interaction">
      {% if spectacle.mode == '1' %}
        <a href="{{ spectacle.set_mobile_interaction_url }}" class="btn btn-danger mobile-interaction"><span>{{ spectacle.mobile_interaction }}</span></a>
      {% else %}
        <span>{{ spectacle.mobile_interaction }}</span>
      {% endif %}
      </div>
    </div>
    <div class="span4">
      <div>
        <h2>Comandos</h2>

        <table class="table" id="command-list">
          <thead>
            <th>Comando</th>
            <th>#</th>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>

      <div>
        <h3>Escolhidos</h3>
        <ul id="chosen-commands-list"></ul>
      </div>
    </div>
    <div class="span2">
      <div class="happiness">
        <h4>Happiness Meter</h4>
        100
        <div class="meter-border">
          <div id="happiness-meter" class="meter" style="height:
                                                         {% if spectacle.mode == '1' %}
                                                         {{ spectacle.easy_happiness_meter }}%;
                                                         {% else %}
                                                         {{ spectacle.hard_happiness_meter }}%;
                                                         {% endif %}">
          </div>
        </div>
        0
      </div>
    </div>
  </div>
  <div class="row">
    <div class="span4">
      <button id="decrease-happiness" class="btn btn-large btn-info">degradação do medidor de felicidade</button>
    </div>
    <div class="span4">
      <button id="reset-spectacle" class="btn btn-large btn-danger">Reiniciar o Espetáculo</button>
    </div>

    {% if spectacle.mode == '2' %}
    <div>
      <div id="hard-countdown">00:00</div>
      <select id="hard_duration">
        <option value="">------</option>
        {% for d in hard_duration %}
        <option value="{{ d.duration|date:"H:i:s" }}">{{ d.duration|date:"H:i:s" }}</option>
        {% endfor %}
      </select>

      <form id="form-scene-duration">{% csrf_token %}
        <input type="hidden" id="duration" name="duration">
      </form>
    </div>
    {% endif %}

    {% if spectacle.mode == '1' %}
    <div>
      <button id="change-spectacle-mode" class="btn btn-large btn-danger">Mudar do Easy para o Hard</button>
    </div>
    {% endif %}
  </div>
  <div class="row">
    <h2>Sequência de slides <small>( fotos/videos )</small></h2>
    <div class="stage">
      <ul class="thumbnails">
        <li class="span2">
          <div class="thumbnail">
            <img src="http://placehold.it/350x150">
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
